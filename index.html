<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PopRush Plus</title>
  <meta name="description" content="PopRush Plus â€” Play, track stats, and climb the local leaderboard!" />
  <style>
    body{font-family:sans-serif;background:#0f1226;color:white;margin:0;padding:0;display:flex;flex-direction:column;align-items:center}
    #board{display:grid;gap:4px;margin-top:10px}
    .tile{width:40px;height:40px;border-radius:8px;display:flex;align-items:center;justify-content:center;font-weight:bold;color:#111;cursor:pointer}
    .c0{background:#ff2f6d}.c1{background:#ff8a00}.c2{background:#2ee96f}.c3{background:#00cde0}.c4{background:#9747ff}
    button{margin:5px;padding:8px 12px;border:none;border-radius:6px;background:#ff2f6d;color:white;font-weight:bold;cursor:pointer}
    #stats,#leaderboard,#history{margin-top:20px;width:90%;max-width:500px}
    h2{margin-bottom:4px}
    table{width:100%;border-collapse:collapse}
    td,th{border-bottom:1px solid rgba(255,255,255,0.2);padding:4px;text-align:left}
  </style>
</head>
<body>
  <h1>PopRush Plus</h1>
  <div>
    <button id="startBtn">Start Game</button>
    <span>Score: <b id="score">0</b></span>
    <span>Time: <b id="time">60</b></span>
    <span>Combo: <b id="combo">x1</b></span>
  </div>
  <div id="board"></div>
  <div id="stats">
    <h2>Lifetime Stats</h2>
    <div>Total Plays: <span id="plays">0</span></div>
    <div>Total Time Played: <span id="timePlayed">0</span> sec</div>
    <div>Color Pops: 
      <span style="color:#ff2f6d">Pink</span> <b id="color0">0</b>, 
      <span style="color:#ff8a00">Orange</span> <b id="color1">0</b>, 
      <span style="color:#2ee96f">Green</span> <b id="color2">0</b>, 
      <span style="color:#00cde0">Cyan</span> <b id="color3">0</b>, 
      <span style="color:#9747ff">Purple</span> <b id="color4">0</b>
    </div>
  </div>
  <div id="leaderboard">
    <h2>Top 10 Scores</h2>
    <table id="lbTable"><tr><th>Rank</th><th>Score</th></tr></table>
  </div>
  <div id="history">
    <h2>Last 10 Games</h2>
    <table id="histTable"><tr><th>Score</th><th>Moves</th><th>Max Combo</th></tr></table>
  </div>

<script>
(function(){
  const COLS=10, ROWS=12, COLORS=5, MIN=2, START_TIME=60;
  let score=0, combo=1, timeLeft=START_TIME, grid=[], timer=null, moves=0, maxCombo=1;
  const $=id=>document.getElementById(id);
  const stats=JSON.parse(localStorage.getItem('poprushStats')||'{"plays":0,"timePlayed":0,"colors":[0,0,0,0,0]}');
  const lb=JSON.parse(localStorage.getItem('poprushLB')||'[]');
  const hist=JSON.parse(localStorage.getItem('poprushHist')||'[]');

  function saveStats(){
    localStorage.setItem('poprushStats',JSON.stringify(stats));
    localStorage.setItem('poprushLB',JSON.stringify(lb));
    localStorage.setItem('poprushHist',JSON.stringify(hist));
  }
  function updateStats(){
    $('plays').textContent=stats.plays;
    $('timePlayed').textContent=stats.timePlayed;
    stats.colors.forEach((c,i)=>$('color'+i).textContent=c);
    const lbTable=$('lbTable'); lbTable.innerHTML='<tr><th>Rank</th><th>Score</th></tr>';
    lb.slice(0,10).forEach((s,i)=>{lbTable.innerHTML+=`<tr><td>${i+1}</td><td>${s}</td></tr>`});
    const hTable=$('histTable'); hTable.innerHTML='<tr><th>Score</th><th>Moves</th><th>Max Combo</th></tr>';
    hist.slice(0,10).forEach(h=>{hTable.innerHTML+=`<tr><td>${h.s}</td><td>${h.m}</td><td>${h.c}</td></tr>`});
  }
  function newTile(){return{color:Math.floor(Math.random()*COLORS)};}
  function render(){
    const board=$('board'); board.innerHTML=''; board.style.gridTemplateColumns=`repeat(${COLS},40px)`;
    for(let y=0;y<ROWS;y++){
      for(let x=0;x<COLS;x++){
        const t=grid[y][x]; const d=document.createElement('div');
        d.className='tile c'+t.color; d.dataset.x=x; d.dataset.y=y;
        d.onclick=()=>clickTile(x,y);
        board.appendChild(d);
      }
    }
  }
  function clickTile(x,y){
    const group=flood(x,y);
    if(group.length>=MIN){
      moves++;
      score+=group.length*group.length*combo;
      stats.colors[grid[y][x].color]+=group.length;
      combo=combo+(group.length>=5?2:1); maxCombo=Math.max(maxCombo,combo);
      group.forEach(([gx,gy])=>grid[gy][gx]=null);
      gravity();
      render();
      $('score').textContent=score;
      $('combo').textContent='x'+combo;
    }
  }
  function flood(x,y){
    const target=grid[y][x]; const seen=new Set(); const q=[[x,y]];
    while(q.length){
      const [cx,cy]=q.pop(); const key=cx+','+cy;
      if(seen.has(key))continue;
      if(grid[cy][cx] && grid[cy][cx].color===target.color){
        seen.add(key);
        [[1,0],[-1,0],[0,1],[0,-1]].forEach(([dx,dy])=>{
          const nx=cx+dx, ny=cy+dy;
          if(nx>=0&&nx<COLS&&ny>=0&&ny<ROWS)q.push([nx,ny]);
        });
      }
    }
    return [...seen].map(s=>s.split(',').map(Number));
  }
  function gravity(){
    for(let x=0;x<COLS;x++){
      let col=[];
      for(let y=0;y<ROWS;y++)if(grid[y][x])col.push(grid[y][x]);
      for(let y=ROWS-1;y>=0;y--)grid[y][x]=col.pop()||newTile();
    }
  }
  function tick(){
    timeLeft--;
    $('time').textContent=timeLeft;
    if(timeLeft<=0){
      clearInterval(timer);
      endGame();
    }
    combo=Math.max(1,Math.floor(combo*0.9));
    $('combo').textContent='x'+combo;
    stats.timePlayed++;
  }
  function startGame(){
    score=0; combo=1; moves=0; maxCombo=1; timeLeft=START_TIME;
    grid=Array.from({length:ROWS},()=>Array.from({length:COLS},newTile));
    render();
    $('score').textContent=score;
    $('time').textContent=timeLeft;
    $('combo').textContent='x1';
    clearInterval(timer); timer=setInterval(tick,1000);
  }
  function endGame(){
    stats.plays++;
    lb.push(score); lb.sort((a,b)=>b-a);
    hist.unshift({s:score,m:moves,c:maxCombo});
    saveStats();
    updateStats();
  }
  $('startBtn').onclick=startGame;
  updateStats();
})();
</script>
</body>
</html>